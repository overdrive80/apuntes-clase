\input{../../../common/plantilla-ejercicio.tex}
\usepackage{eurosym}


\renewcommand{\hmwkClass}{Planificación y Administración de Redes}
\renewcommand{\hmwkTitle}{Práctica VLAN en Cisco}




\begin{document}

% \maketitle

% ----------------------------------------------------------------------------------------
%	TABLE OF CONTENTS
% ----------------------------------------------------------------------------------------

% \setcounter{tocdepth}{1} % Uncomment this line if you don't want subsections listed in the ToC

\primerapagina

\setlength{\parindent}{0em}
\setlength{\parskip}{1em}


\section{Objetivo de la práctica}
Los objetivos de la práctica son:
\begin{itemize}
\item Diseñar una red en la que se tenga en cuenta la seguridad
\item Configurar VLAN 802.1Q y reglas de acceso de \textit{firewall}
\item Conocer comandos IOS de Cisco
\end{itemize}


La última versión de esta práctica está disponible en \enlace{https://alvarogonzalezsotillo.github.io/apuntes-clase/planificacion-administracion-redes-asir1/apuntes/7/par-7-practica-vlan-cisco.pdf}{este enlace}.


\section{Enunciado}
\begin{itemize}
\item En una empresa hay dos departamentos: \textbf{comerciales} y \textbf{soporte} al cliente.
\item Todos los empleados acceden a internet a través del mismo router.
\item Los comerciales guardan sus archivos importantes en una carpeta compartida en un servidor, localizado en el CPD del sótano. Este servidor no debe ser accedido por ningún empleado de soporte, y no tiene conexión con internet para eliminar posibles problemas.
\item El departamento de soporte al cliente utiliza otro servidor con una base de datos de sus actividades, localizado también en el CPD. Tras detectar algunas malas prácticas por parte de un comercial, se quiere que los comerciales no tengan acceso a dicho servidor.
\item El departamento de informática debe poder acceder a todos los ordenadores, para realizar su mantenimiento.
\end{itemize}

\begin{homeworkProblem}[: Diseña la red en Packet Tracer (2 puntos)]
  \begin{itemize}
  \item Incluye al menos:
    \begin{itemize}
    \item Dos ordenadores por departamento (informática, comercial, soporte)
    \item Un switch por departamento
    \item Un switch para el CPD, donde se conectarán los servidores y el router con acceso a Internet.
    \end{itemize}
  \item Los equipos estarán en subredes de \texttt{10.N.0.0/16}.
    
  \item Además de los pedidos en el enunciado, pueden añadirse los switches y routers adicionales que se necesiten.
  \end{itemize}
\end{homeworkProblem}

\begin{homeworkProblem}[: Conectate a B por medio de escritorio remoto, desde tu PC físico (1 punto)]
  \begin{itemize}
    
  \item Busca qué puerto utiliza el protocolo RDP y ábrelo (\enlace{http://albertomolina.wordpress.com/2009/01/09/nat-con-iptables/}{albertomolina}, apartado prerouting)
  \item Activa el escritorio remoto en \textbf{B} (Propiedades del sistema $\rightarrow$ Remoto $\rightarrow$ Permitir escritorio remoto)
    
  \item Habilita algún usuario para que pueda conectarse por medio de escritorio remoto
  \item Conéctate desde tu PC físico con la orden \texttt{mstsc} en  Windows (o \texttt{rdesktop}/\texttt{remmina} si el ordenador físico tiene Linux)
  \end{itemize}

\end{homeworkProblem}


\begin{homeworkProblem}[: Conectate a B desde el equipo B de otro compañero (1 punto)]
  Necesitarás repetir los pasos anteriores, pero para otra tarjeta de red (la de dirección \texttt{192.168.255.N}).
\end{homeworkProblem}


\begin{homeworkProblem}[: Convierte a B en un servidor de ficheros (carpetas compartidas) (2 puntos)]
  \begin{itemize}
  \item Abre los puertos necesarios en \textbf{A} para que pueda accederse a \textbf{B} como servidor de ficheros (\enlace{http://www.chicagotech.net/netforums/viewtopic.php?t=5067}{ayuda}).
  \item Debe poder accederse desde cualquier red externa.
  \item  Los puertos TCP se indican con el flag \texttt{-p tcp}. Los puertos UDP se indican con el flag \texttt{-p udp}.
    
  \item Comparte alguna carpeta en B. Recuerda que en Windows
    \begin{itemize}
    \item Es mejor desactivar “Utilizar el uso compartido simple de archivos”
    \item El usuario que se utiliza para acceder remotamente debe tener contraseña
    \end{itemize}

  \end{itemize}

\end{homeworkProblem}


\begin{homeworkProblem}[: Haz que A y C puedan ser administrados mediante SSH desde la red del aula (2 puntos)]
  \begin{itemize}
  \item Instala openssh-server en los dos ordenadores, si no está ya instalado.
  \item Abre los puertos necesarios para llegar a \textbf{C} por SSH desde la red del aula.
    
  \item Debe ser posible, desde la red del aula y la \texttt{192.168.255.N/24}, conectarse simultáneamente a \textbf{A} y \textbf{C} por SSH.
  \end{itemize}
\end{homeworkProblem}

\begin{homeworkProblem}[: Comprueba el NAT con \texttt{tcpdump} (2 puntos)]
  \begin{itemize}
  \item Abre dos consolas en la máquina \textbf{A}. Utiliza \texttt{tcpdump} para ver en una consola los paquetes ICMP enviados y recibidos (\enlace{https://forum.ivorde.com/tcpdump-how-to-to-capture-only-icmp-ping-echo-requests-t15191.html}{forum.ivorde.com}) por la tarjeta conectada a internet. En la otra consola, visualiza los paquetes ICMP de la tarjeta de red interna.
    \begin{itemize}
    \item También puede usarse \texttt{WireShark}
    \end{itemize}
  \item Ejecuta un \texttt{ping} a internet desde la máquina \textbf{B}.
  \item Comprueba que la máquina \textbf{A}, además de enrutar, está cambiado las direcciones IP de origen y destino.
  \end{itemize}
\end{homeworkProblem}


\section{Normas de entrega}
\begin{itemize}
\item Avisa al profesor para que compruebe el funcionamiento de cada ejercicio. 
\item Se entregará una memoria con el formato acostumbrado. No es necesario explicar cada paso (en modo tutorial), solo demostrar que se han realizado las tareas.
\item La memoria incluirá

  \begin{itemize}
  \item Un esquema de la red (2 puntos)
  \item Las órdenes realizadas en el servidor Linux para conseguir realizar el NAT correctamente.
  \item Pantallazos que demuestren que se han realizado las tareas pedidas
  \item
    \begin{small}
      Nota: Las órdenes que manejan NAT en Linux deben comenzar siempre desde la primera. Se recomienda hacer un script SH para las órdenes.
    \end{small}
    
  \end{itemize}

\end{itemize}


\begin{comment}
  #!/bin/bash

  INTERNET=enp0s3
  ALUMNOS=enp0s8
  INTERNA=enp0s9

  SERVIDORWINDOWS=10.0.0.2
  LINUXINTERNO=10.0.0.3


  # ACTIVA ENRUTAMIENTO
  echo "1" > /proc/sys/net/ipv4/ip_forward


  # LIMPIAR TABLAS
  iptables -P INPUT ACCEPT
  iptables -P FORWARD ACCEPT
  iptables -P OUTPUT ACCEPT
  iptables -t nat -F
  iptables -t mangle -F
  iptables -F
  iptables -X

  # NAT POR TARJETA CON INTERNET enp0s3
  iptables -t nat -A POSTROUTING -o $INTERNET -j MASQUERADE

  # NAT POR TARJETA ENTRE ALUMNOS
  iptables -t nat -A POSTROUTING -o $ALUMNOS -j MASQUERADE

  # ABRIR 3389 A SERVIDORWINDOWS
  iptables -t nat -A PREROUTING -p tcp --dport 3389 -j DNAT --to $SERVIDORWINDOWS:3389

  # ABRIR 22022 A LINUXINTERNO                                                                                                                                              
  iptables -t nat -A PREROUTING -p tcp --dport 22022 -j DNAT --to $LINUXINTERNO:22


  # CARPETAS COMPARTIDAS SERVIDOR WINDOWS
  TCPPORTS="139 445"
  UDPPORTS=""
  for PORT in $TCPPORTS
  do
  iptables -t nat -A PREROUTING -p tcp --dport $PORT -j DNAT --to $SERVIDORWINDOWS:$PORT
  done
  for PORT in $UDPPORTS
  do
  iptables -t nat -A PREROUTING -p udp --dport $PORT -j DNAT --to $SERVIDORWINDOWS:$PORT
  done


  # COMO QUEDAN LAS TABLAS
  iptables-save

  # VIGILAR EL PING PARA VER EL NAT
  tcpdump -v -v -n -i $INTERNA icmp&
  tcpdump -v -v -n -i $INTERNET icmp&


\end{comment}

\end{document}
